# ============================================================
#  Ø¨ÙˆØª Ø¨ÙÙƒØ³Ù„Ø© â€” Bixala Bot
#  Ø§Ù„ÙˆØ¸ÙŠÙØ©: ÙŠØ¬Ù…Ø¹ ØµÙˆØ± Ø§Ù„Ù…Ù‚ØªÙ†ÙŠØ§Øª Ø§Ù„ØªØ±Ø§Ø«ÙŠØ© Ù…Ù† Ù¦ Ø²ÙˆØ§ÙŠØ§
#  Ø«Ù… ÙŠØ±ÙØ¹Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆÙŠØ¹Ø·ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ Ø±ÙˆØ§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø©
#  ÙˆÙŠÙˆØ¬Ù‘Ù‡Ù‡ Ù„Ù†Ù…ÙˆØ°Ø¬ Airtable Ù„ØªØ¹Ø¨Ø¦Ø© Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
# ============================================================

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“¦ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
import logging          # Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø« ÙÙŠ Ø§Ù„Ù€ console
import os               # Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© (Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª ÙˆØ§Ù„Ù…ÙØ§ØªÙŠØ­)
import base64           # Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ù†Øµ base64 Ù‚Ø¨Ù„ Ø±ÙØ¹Ù‡Ø§
import requests         # Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ Ø®Ø¯Ù…Ø© imgBB Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
from telegram import (
    Update,
    ReplyKeyboardMarkup,   # Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§Ù„Ù„ÙŠ ØªØ¸Ù‡Ø± Ø¨Ø¯Ù„ Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯
    ReplyKeyboardRemove,   # Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
    InlineKeyboardButton,  # Ø²Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù†ÙØ³Ù‡Ø§
    InlineKeyboardMarkup,  # ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
)
from telegram.ext import (
    Application,            # Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø¨ÙˆØª
    CommandHandler,         # ÙŠØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ø«Ù„ /start Ùˆ /cancel
    MessageHandler,         # ÙŠØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙˆØ§Ù„ØµÙˆØ±
    CallbackQueryHandler,   # ÙŠØ³ØªÙ‚Ø¨Ù„ Ø¶ØºØ·Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
    ConversationHandler,    # ÙŠÙ†Ø¸Ù‘Ù… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙƒÙ…Ø±Ø§Ø­Ù„ Ù…ØªØªØ§Ø¨Ø¹Ø©
    filters,                # ÙÙ„Ø§ØªØ± Ù„ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© (Ù†ØµØŒ ØµÙˆØ±Ø©ØŒ Ø¥Ù„Ø®)
    ContextTypes,           # Ù†ÙˆØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ù‚
)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
# Ù‡Ø°ÙŠ Ø§Ù„Ù‚ÙŠÙ… ØªÙØ¶Ø§Ù ÙƒÙ€ Variables ÙÙŠ Railway ÙˆÙ…Ø§ ØªÙ†ÙƒØªØ¨ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BOT_TOKEN = os.environ["BOT_TOKEN"]                          # ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª Ù…Ù† @BotFather
IMGBB_API_KEY = os.environ["IMGBB_API_KEY"]                  # Ù…ÙØªØ§Ø­ API Ù…Ù† Ù…ÙˆÙ‚Ø¹ imgbb.com
AIRTABLE_FORM_URL = os.environ.get("AIRTABLE_FORM_URL", "")  # Ø±Ø§Ø¨Ø· Ù†Ù…ÙˆØ°Ø¬ Airtable (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ”¢ ØªØ¹Ø±ÙŠÙ Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
# ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© Ù„Ù‡Ø§ Ø±Ù‚Ù… â€” Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ø±Ù ÙˆÙŠÙ† Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ ÙˆØµÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„ÙŠÙ‡
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(
    NAME,           # 0 â€” Ù…Ø±Ø­Ù„Ø© ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù…
    ITEM_TYPE,      # 1 â€” Ù…Ø±Ø­Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø© (Ø£Ø²Ø±Ø§Ø±)
    ITEM_NAME,      # 2 â€” Ù…Ø±Ø­Ù„Ø© ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© (Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± "Ø£Ø®Ø±Ù‰")
    PHOTO_1,        # 3 â€” ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø£Ù…Ø§Ù…
    PHOTO_2,        # 4 â€” ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø®Ù„Ù
    PHOTO_3,        # 5 â€” ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù†
    PHOTO_4,        # 6 â€” ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø±
    PHOTO_5,        # 7 â€” ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰
    PHOTO_6,        # 8 â€” ØµÙˆØ±Ø© ØªÙØ§ØµÙŠÙ„ Ù…Ù…ÙŠØ²Ø©
) = range(9)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸº Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„ØªØ±Ø§Ø«ÙŠØ© â€” ØªØ¸Ù‡Ø± ÙƒØ£Ø²Ø±Ø§Ø± Ù„Ù„Ù…Ø´Ø§Ø±Ùƒ
# ğŸ’¡ Ø¥Ø°Ø§ ØªØ¨ÙŠ ØªØ¶ÙŠÙ Ø£Ùˆ ØªØ­Ø°Ù Ù†ÙˆØ¹ØŒ Ø¹Ø¯Ù‘Ù„ Ù‡Ù†Ø§ ÙÙ‚Ø·
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ITEM_TYPES = [
    ["Ø¯Ù„Ø© Ù‚Ù‡ÙˆØ© â˜•", "Ù…Ø¨Ø®Ø±Ø© ğŸª”"],
    ["Ø³Ø¬Ø§Ø¯Ø© ğŸ§¶", "Ø®Ù†Ø¬Ø± ğŸ—¡ï¸"],
    ["Ø£ÙˆØ§Ù†ÙŠ ÙØ®Ø§Ø±ÙŠØ© ğŸº", "Ù…Ù„Ø§Ø¨Ø³ ØªØ±Ø§Ø«ÙŠØ© ğŸ‘˜"],
    ["Ø­ÙÙ„ÙŠ ÙˆÙ…Ø¬ÙˆÙ‡Ø±Ø§Øª ğŸ’", "Ø£Ø¯ÙˆØ§Øª Ø­Ø±ÙÙŠØ© ğŸ”¨"],
    ["Ø£Ø®Ø±Ù‰ âœï¸"],
]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø²ÙˆØ§ÙŠØ§ Ø§Ù„Ø³Øª Ù„Ù„ØªØµÙˆÙŠØ±
# ÙƒÙ„ Ø¹Ù†ØµØ± ÙŠØ­ØªÙˆÙŠ: Ø±Ù‚Ù… Ø§Ù„Ø®Ø·ÙˆØ©ØŒ Ø§Ø³Ù… Ø§Ù„Ø²Ø§ÙˆÙŠØ©ØŒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ù„Ù…Ø´Ø§Ø±Ùƒ
# ğŸ’¡ Ø¥Ø°Ø§ ØªØ¨ÙŠ ØªØºÙŠÙ‘Ø± Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§ÙŠØ§ Ø£Ùˆ Ø§Ù„Ù†ØµÙˆØµØŒ Ø¹Ø¯Ù‘Ù„ Ù‡Ù†Ø§ ÙÙ‚Ø·
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PHOTO_STEPS = [
    {
        "num": "Ù¡/Ù¦",
        "angle": "Ù…Ù† Ø§Ù„Ø£Ù…Ø§Ù… ğŸ”²",
        "instruction": "ØµÙˆÙ‘Ø± Ø§Ù„Ù‚Ø·Ø¹Ø© Ù…Ù† Ø§Ù„Ø£Ù…Ø§Ù… Ù…Ø¨Ø§Ø´Ø±Ø©.\nğŸ’¡ Ø®Ù„Ù‘ Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© ÙˆØ§Ø¶Ø­Ø© ÙˆØ§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ø³ÙŠØ·Ø©."
    },
    {
        "num": "Ù¢/Ù¦",
        "angle": "Ù…Ù† Ø§Ù„Ø®Ù„Ù ğŸ”³",
        "instruction": "Ø£Ø¯Ø± Ø§Ù„Ù‚Ø·Ø¹Ø© ÙˆØµÙˆÙ‘Ø±Ù‡Ø§ Ù…Ù† Ø§Ù„Ø®Ù„Ù."
    },
    {
        "num": "Ù£/Ù¦",
        "angle": "Ù…Ù† Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù† â¡ï¸",
        "instruction": "ØµÙˆÙ‘Ø±Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù†."
    },
    {
        "num": "Ù¤/Ù¦",
        "angle": "Ù…Ù† Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø± â¬…ï¸",
        "instruction": "ØµÙˆÙ‘Ø±Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø±."
    },
    {
        "num": "Ù¥/Ù¦",
        "angle": "Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ â¬†ï¸",
        "instruction": "ØµÙˆÙ‘Ø±Ù‡Ø§ Ù…Ù† ÙÙˆÙ‚ (Ù…Ù†Ø¸Ø± Ø¹Ù„ÙˆÙŠ)."
    },
    {
        "num": "Ù¦/Ù¦",
        "angle": "ØªÙØ§ØµÙŠÙ„ Ù…Ù…ÙŠØ²Ø© âœ¨",
        "instruction": "ØµÙˆÙ‘Ø± Ø£ÙŠ Ù†Ù‚Ø´ Ø£Ùˆ Ø¹Ù„Ø§Ù…Ø© Ø£Ùˆ ØªÙØµÙŠÙ„Ø© Ù…Ù…ÙŠØ²Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø·Ø¹Ø©.\nØ¥Ø°Ø§ Ù…Ø§ ÙÙŠÙ‡ØŒ ØµÙˆÙ‘Ø±Ù‡Ø§ Ù…Ù† Ø£ÙŠ Ø²Ø§ÙˆÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© ØªØ­Ø¨Ù‡Ø§."
    },
]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“‹ Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Ù…ÙÙŠØ¯ Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    level=logging.INFO,
)
logger = logging.getLogger(__name__)


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ–¼ï¸ Ø¯Ø§Ù„Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø¹Ù„Ù‰ imgBB
# ØªØ§Ø®Ø° Ø§Ù„ØµÙˆØ±Ø© ÙƒÙ€ bytes ÙˆØªØ±Ø¬Ø¹ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± Ø£Ùˆ None Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
def upload_to_imgbb(file_bytes: bytes) -> str | None:
    """ÙŠØ±ÙØ¹ ØµÙˆØ±Ø© Ø¹Ù„Ù‰ imgBB ÙˆÙŠØ±Ø¬Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±."""
    try:
        # ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ù†Øµ base64 Ù„Ø£Ù† imgBB ÙŠØ³ØªÙ‚Ø¨Ù„Ù‡Ø§ Ø¨Ù‡Ø§Ù„Ø´ÙƒÙ„
        b64 = base64.b64encode(file_bytes).decode("utf-8")

        # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ imgBB Ø¹Ø¨Ø± Ø§Ù„Ù€ API
        resp = requests.post(
            "https://api.imgbb.com/1/upload",
            data={
                "key": IMGBB_API_KEY,
                "image": b64,
            },
            timeout=30,
        )

        # Ø¥Ø°Ø§ Ù†Ø¬Ø­ Ø§Ù„Ø·Ù„Ø¨
        if resp.status_code == 200:
            data = resp.json()
            if data.get("success"):
                return data["data"]["url"]

    except Exception as e:
        logger.error(f"imgBB upload error: {e}")

    return None


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”§ Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© â€” ØªØ¬Ù‡Ù‘Ø² Ø±Ø³Ø§Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ø¹ Ø§Ù„Ù†ØµØ§Ø¦Ø­
# ØªÙØ³ØªØ¯Ø¹Ù‰ Ø¨Ø¹Ø¯ Ù…Ø§ Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ ÙŠØ®ØªØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø©
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async def ask_first_photo(update_or_query, context: ContextTypes.DEFAULT_TYPE) -> int:
    """ØªØ±Ø³Ù„ Ù†ØµØ§Ø¦Ø­ Ø§Ù„ØªØµÙˆÙŠØ± ÙˆØªØ·Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰."""
    item = context.user_data["item_name"]
    step = PHOTO_STEPS[0]

    text = (
        f"Ù…Ù…ØªØ§Ø²! Ø¨Ù†ØµÙˆÙ‘Ø± *{item}* Ù…Ù† Ù¦ Ø²ÙˆØ§ÙŠØ§ ğŸ“·\n\n"
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"
        "ğŸ’¡ *Ù†ØµØ§Ø¦Ø­ Ø³Ø±ÙŠØ¹Ø© Ù„Ù„ØªØµÙˆÙŠØ±:*\n"
        "â€¢ Ø§Ø³ØªØ®Ø¯Ù… Ø¥Ø¶Ø§Ø¡Ø© Ø·Ø¨ÙŠØ¹ÙŠØ© Ø£Ùˆ ÙˆØ§Ø¶Ø­Ø©\n"
        "â€¢ Ø®Ù„Ù‘ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ø³ÙŠØ·Ø© (Ø£Ø¨ÙŠØ¶ Ø£Ùˆ Ù„ÙˆÙ† ÙˆØ§Ø­Ø¯)\n"
        "â€¢ Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… ÙÙ„Ø§Ø´\n"
        "â€¢ ØªØ£ÙƒØ¯ Ø§Ù„Ù‚Ø·Ø¹Ø© ÙˆØ§Ø¶Ø­Ø© ÙˆÙƒØ§Ù…Ù„Ø© ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©\n"
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n"
        f"ğŸ“¸ *Ø§Ù„ØµÙˆØ±Ø© {step['num']} â€” {step['angle']}*\n"
        f"{step['instruction']}"
    )

    # Ù†Ø­Ø¯Ø¯ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ« (Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ø¯ÙŠØ© Ø£Ùˆ Ø¶ØºØ·Ø© Ø²Ø±)
    if hasattr(update_or_query, 'message') and update_or_query.message:
        await update_or_query.message.reply_text(
            text,
            parse_mode="Markdown",
            reply_markup=ReplyKeyboardRemove(),  # Ø¥Ø²Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
        )
    else:
        await update_or_query.callback_query.message.reply_text(
            text,
            parse_mode="Markdown",
        )

    return PHOTO_1


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸŸ¢ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© â€” Ø£ÙˆÙ„ Ø´ÙŠØ¡ ÙŠØµÙŠØ± Ù„Ù…Ø§ Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ ÙŠØ±Ø³Ù„ Ø£ÙŠ Ø±Ø³Ø§Ù„Ø©
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    # Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    context.user_data.clear()
    context.user_data["photos"] = []

    # Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙˆØ·Ù„Ø¨ Ø§Ù„Ø§Ø³Ù…
    await update.message.reply_text(
        "âœ¨ *Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙÙƒØ³Ù„Ø©!*\n\n"
        "Ù†Ø­Ù† Ù†Ø­ÙØ¸ Ø§Ù„Ø¥Ø±Ø« Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠ Ø±Ù‚Ù…ÙŠÙ‹Ø§ ğŸº\n\n"
        "Ø³Ø£Ø³Ø§Ø¹Ø¯Ùƒ ØªØ±ÙØ¹ ØµÙˆØ± Ù‚Ø·Ø¹ØªÙƒ Ø§Ù„ØªØ±Ø§Ø«ÙŠØ© Ù…Ù† Ù¦ Ø²ÙˆØ§ÙŠØ§ Ù…Ø®ØªÙ„ÙØ©ØŒ "
        "ÙˆØ¨Ø¹Ø¯Ù‡Ø§ Ø£Ø¹Ø·ÙŠÙƒ Ø±Ø§Ø¨Ø· ØªÙ„ØµÙ‚Ù‡ ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©.\n\n"
        "ğŸ“ *Ø£Ø±Ø³Ù„ Ù„ÙŠ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„:*",
        parse_mode="Markdown",
        reply_markup=ReplyKeyboardRemove(),  # Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø£Ø²Ø±Ø§Ø± Ù‚Ø¯ÙŠÙ…Ø©
    )
    return NAME


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ‘¤ Ø¯Ø§Ù„Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø§Ø³Ù… â€” ØªØ­ÙØ¸ Ø§Ù„Ø§Ø³Ù… ÙˆØªØ¹Ø±Ø¶ Ø£Ø²Ø±Ø§Ø± Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù‚Ø·Ø¹
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async def get_name(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    # Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…
    context.user_data["name"] = update.message.text.strip()
    name = context.user_data["name"]

    # Ø¹Ø±Ø¶ Ø£Ø²Ø±Ø§Ø± Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù‚Ø·Ø¹ â€” ReplyKeyboardMarkup ÙŠØ®Ù„Ù‘ÙŠÙ‡Ø§ ØªØ¸Ù‡Ø± Ø¨Ø¯Ù„ Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯
    await update.message.reply_text(
        f"Ø£Ù‡Ù„Ø§Ù‹ *{name}!* ğŸ‘‹\n\n"
        "ğŸº *Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„ØªØ±Ø§Ø«ÙŠØ©:*",
        parse_mode="Markdown",
        reply_markup=ReplyKeyboardMarkup(
            ITEM_TYPES,                # Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ù…Ø¹Ø±Ù‘ÙØ© ÙÙˆÙ‚)
            one_time_keyboard=True,    # ØªØ®ØªÙÙŠ Ø¨Ø¹Ø¯ Ù…Ø§ ÙŠØ¶ØºØ·
            resize_keyboard=True,      # ØªØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©
            input_field_placeholder="Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø©..."  # Ù†Øµ ØªÙˆØ¶ÙŠØ­ÙŠ
        ),
    )
    # Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø©
    return ITEM_TYPE


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸº Ø¯Ø§Ù„Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø© â€” Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø±
# Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± "Ø£Ø®Ø±Ù‰" ÙŠØ·Ù„Ø¨ Ù…Ù†Ù‡ ÙŠÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… ÙŠØ¯ÙˆÙŠÙ‹Ø§
# Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± Ù†ÙˆØ¹ Ù…Ø­Ø¯Ø¯ØŒ ÙŠØ­ÙØ¸Ù‡ ÙˆÙŠØ¨Ø¯Ø£ Ø§Ù„ØªØµÙˆÙŠØ± Ù…Ø¨Ø§Ø´Ø±Ø©
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async def get_item_type(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    chosen = update.message.text.strip()

    # Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± "Ø£Ø®Ø±Ù‰" â€” Ø§Ø·Ù„Ø¨ Ù…Ù†Ù‡ ÙŠÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§
    if "Ø£Ø®Ø±Ù‰" in chosen:
        await update.message.reply_text(
            "ğŸ“ *Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„ØªØ±Ø§Ø«ÙŠØ©:*\n"
            "Ù…Ø«Ø§Ù„: Ù…ÙØªØ§Ø­ Ù‚Ø¯ÙŠÙ…ØŒ ØµÙ†Ø¯ÙˆÙ‚ Ø®Ø´Ø¨ÙŠØŒ Ù…Ø±Ø¢Ø© Ù†Ø­Ø§Ø³ÙŠØ©...",
            parse_mode="Markdown",
            reply_markup=ReplyKeyboardRemove(),  # Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        )
        # Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù…Ø±Ø­Ù„Ø© ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… ÙŠØ¯ÙˆÙŠÙ‹Ø§
        return ITEM_NAME

    # Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± Ù†ÙˆØ¹ Ù…Ø­Ø¯Ø¯ â€” Ù†Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù… Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
    # Ù†Ø´ÙŠÙ„ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù…Ù† Ø¢Ø®Ø± Ø§Ù„Ù†Øµ (Ù…Ø«Ù„ "Ø¯Ù„Ø© Ù‚Ù‡ÙˆØ© â˜•" ØªØµÙŠØ± "Ø¯Ù„Ø© Ù‚Ù‡ÙˆØ©")
    item_name = chosen.rsplit(" ", 1)[0] if any(ord(c) > 127 for c in chosen.split()[-1]) else chosen
    context.user_data["item_name"] = item_name

    # Ù†Ù†ØªÙ‚Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø·Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
    return await ask_first_photo(update, context)


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âœï¸ Ø¯Ø§Ù„Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© â€” Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± "Ø£Ø®Ø±Ù‰" ÙˆÙƒØªØ¨ ÙŠØ¯ÙˆÙŠÙ‹Ø§
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async def get_item_name(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    context.user_data["item_name"] = update.message.text.strip()
    return await ask_first_photo(update, context)


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“· Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± â€” ØªÙØ³ØªØ¯Ø¹Ù‰ ÙƒÙ„ Ù…Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ ÙŠØ±Ø³Ù„ ØµÙˆØ±Ø©
# ØªØ­Ù…Ù‘Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† ØªÙŠÙ„ÙŠÙ‚Ø±Ø§Ù…ØŒ ØªØ±ÙØ¹Ù‡Ø§ Ø¹Ù„Ù‰ imgBBØŒ ØªØ­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø·
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async def handle_photo(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    # Ù…Ø¹Ø±ÙØ© ÙƒÙ… ØµÙˆØ±Ø© Ø±ÙØ¹Ù†Ø§Ù‡Ø§ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†
    current_step = len(context.user_data["photos"])

    # â”€â”€â”€ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø³ÙŠØ±ÙØ±Ø§Øª ØªÙŠÙ„ÙŠÙ‚Ø±Ø§Ù… â”€â”€â”€
    photo = update.message.photo[-1]  # [-1] ÙŠØ¹Ø·ÙŠÙ†Ø§ Ø£Ø¹Ù„Ù‰ Ø¬ÙˆØ¯Ø©
    file = await photo.get_file()
    file_bytes = await file.download_as_bytearray()

    # â”€â”€â”€ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù„Ù‰ imgBB â”€â”€â”€
    await update.message.reply_text("â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©...")
    link = upload_to_imgbb(bytes(file_bytes))

    # Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹
    if not link:
        await update.message.reply_text(
            "âŒ Ø­ØµÙ„ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹. Ø£Ø±Ø³Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©."
        )
        return PHOTO_1 + current_step

    # â”€â”€â”€ Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· â”€â”€â”€
    context.user_data["photos"].append(
        {"angle": PHOTO_STEPS[current_step]["angle"], "url": link}
    )

    await update.message.reply_text(f"âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© {current_step + 1}/Ù¦")

    # â”€â”€â”€ Ù‡Ù„ ÙƒÙ…Ù„Ù†Ø§ Ù¦ ØµÙˆØ±ØŸ â”€â”€â”€
    if current_step + 1 >= 6:
        return await finish(update, context)

    # â”€â”€â”€ Ø·Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© â”€â”€â”€
    next_step = PHOTO_STEPS[current_step + 1]
    await update.message.reply_text(
        f"ğŸ“¸ *Ø§Ù„ØµÙˆØ±Ø© {next_step['num']} â€” {next_step['angle']}*\n"
        f"{next_step['instruction']}",
        parse_mode="Markdown",
    )
    return PHOTO_1 + current_step + 1


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ‰ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ â€” ØªÙØ³ØªØ¯Ø¹Ù‰ Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ù¦ ØµÙˆØ±
# ØªØ±Ø³Ù„ Ù„Ù„Ù…Ø´Ø§Ø±Ùƒ ÙƒÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· + Ø±Ø§Ø¨Ø· Ù†Ù…ÙˆØ°Ø¬ Airtable
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async def finish(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    name = context.user_data["name"]
    item = context.user_data["item_name"]
    photos = context.user_data["photos"]

    # â”€â”€â”€ Ø¨Ù†Ø§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙØµÙ‘Ù„Ø© â”€â”€â”€
    links_text = ""
    for i, p in enumerate(photos, 1):
        links_text += f"{i}. {p['angle']}\nğŸ”— {p['url']}\n\n"

    # â”€â”€â”€ ØªØ¬Ù…ÙŠØ¹ ÙƒÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· (Ø³Ù‡Ù„ Ø§Ù„Ù†Ø³Ø®) â”€â”€â”€
    all_urls = "\n".join([p["url"] for p in photos])

    await update.message.reply_text(
        f"ğŸ‰ *Ù…Ù…ØªØ§Ø² {name}!*\n\n"
        f"ØªÙ… Ø±ÙØ¹ Ù¦ ØµÙˆØ± Ù„Ù€ *{item}* Ø¨Ù†Ø¬Ø§Ø­!\n\n"
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"
        f"ğŸ“‹ *Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ±:*\n\n"
        f"{links_text}"
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n"
        "ğŸ“‹ *Ø§Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·:*",
        parse_mode="Markdown",
    )

    # Ø±Ø³Ø§Ù„Ø© Ù…Ù†ÙØµÙ„Ø© Ø¨Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙÙ‚Ø· (Ø³Ù‡Ù„ Ø§Ù„Ù†Ø³Ø®)
    await update.message.reply_text(
        f"ğŸ“ Ø±ÙˆØ§Ø¨Ø· ØµÙˆØ±: {item}\n\n{all_urls}",
    )

    # â”€â”€â”€ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ù†Ù…ÙˆØ°Ø¬ Airtable â”€â”€â”€
    if AIRTABLE_FORM_URL:
        await update.message.reply_text(
            "ğŸ“ *Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©:*\n\n"
            "Ø§Ù„ØµÙ‚ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ğŸ‘‡\n"
            f"ğŸ”— {AIRTABLE_FORM_URL}\n\n"
            "Ø´ÙƒØ±Ù‹Ø§ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ ÙÙŠ Ø¨ÙÙƒØ³Ù„Ø©! ğŸ™âœ¨\n\n"
            "Ù„ØªØµÙˆÙŠØ± Ù‚Ø·Ø¹Ø© Ø£Ø®Ø±Ù‰ Ø£Ø±Ø³Ù„ Ø£ÙŠ Ø±Ø³Ø§Ù„Ø©",
            parse_mode="Markdown",
        )
    else:
        await update.message.reply_text(
            "Ø´ÙƒØ±Ù‹Ø§ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ ÙÙŠ Ø¨ÙÙƒØ³Ù„Ø©! ğŸ™âœ¨\n\n"
            "Ù„ØªØµÙˆÙŠØ± Ù‚Ø·Ø¹Ø© Ø£Ø®Ø±Ù‰ Ø£Ø±Ø³Ù„ Ø£ÙŠ Ø±Ø³Ø§Ù„Ø©",
        )

    return ConversationHandler.END


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âŒ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ù„ØºØ§Ø¡ â€” Ø£Ù…Ø± /cancel
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async def cancel(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    await update.message.reply_text(
        "ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ âŒ\nØªÙ‚Ø¯Ø± ØªØ¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø£ÙŠ Ø±Ø³Ø§Ù„Ø©",
        reply_markup=ReplyKeyboardRemove(),
    )
    return ConversationHandler.END


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# â­ï¸ Ø¯Ø§Ù„Ø© ØªØ®Ø·ÙŠ Ø§Ù„ØµÙˆØ±Ø© â€” Ø£Ù…Ø± /skip
# ÙÙ‚Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© (Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù…ÙŠØ²Ø©) Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ®Ø·ÙŠ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async def skip_photo(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    current_step = len(context.user_data["photos"])

    if current_step == 5:
        context.user_data["photos"].append(
            {"angle": PHOTO_STEPS[5]["angle"], "url": "â€”"}
        )
        return await finish(update, context)

    await update.message.reply_text("âš ï¸ Ù‡Ø°ÙŠ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø·Ù„ÙˆØ¨Ø©. Ø£Ø±Ø³Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ùˆ Ø³Ù…Ø­Øª.")
    return PHOTO_1 + current_step


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© â€” ØªØ±Ø¨Ø· ÙƒÙ„ Ø´ÙŠØ¡ Ø¨Ø¨Ø¹Ø¶ ÙˆØªØ´ØºÙ‘Ù„ Ø§Ù„Ø¨ÙˆØª
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
def main():
    app = Application.builder().token(BOT_TOKEN).build()

    # â”€â”€â”€ ØªØ¹Ø±ÙŠÙ Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© â”€â”€â”€
    conv_handler = ConversationHandler(
        # Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© ØªØ¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        entry_points=[
            CommandHandler("start", start),
            MessageHandler(filters.TEXT & ~filters.COMMAND, start),
            MessageHandler(filters.PHOTO, start),
        ],

        # Ø§Ù„Ù…Ø±Ø§Ø­Ù„
        states={
            # Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø³Ù…: ØªØ³ØªÙ‚Ø¨Ù„ Ù†Øµ
            NAME: [MessageHandler(filters.TEXT & ~filters.COMMAND, get_name)],

            # Ù…Ø±Ø­Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø©: ØªØ³ØªÙ‚Ø¨Ù„ Ù†Øµ (Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø±)
            ITEM_TYPE: [MessageHandler(filters.TEXT & ~filters.COMMAND, get_item_type)],

            # Ù…Ø±Ø­Ù„Ø© ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§ (Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± "Ø£Ø®Ø±Ù‰")
            ITEM_NAME: [MessageHandler(filters.TEXT & ~filters.COMMAND, get_item_name)],

            # Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø³Øª
            PHOTO_1: [
                MessageHandler(filters.PHOTO, handle_photo),
                CommandHandler("skip", skip_photo),
            ],
            PHOTO_2: [
                MessageHandler(filters.PHOTO, handle_photo),
                CommandHandler("skip", skip_photo),
            ],
            PHOTO_3: [
                MessageHandler(filters.PHOTO, handle_photo),
                CommandHandler("skip", skip_photo),
            ],
            PHOTO_4: [
                MessageHandler(filters.PHOTO, handle_photo),
                CommandHandler("skip", skip_photo),
            ],
            PHOTO_5: [
                MessageHandler(filters.PHOTO, handle_photo),
                CommandHandler("skip", skip_photo),
            ],
            PHOTO_6: [
                MessageHandler(filters.PHOTO, handle_photo),
                CommandHandler("skip", skip_photo),
            ],
        },

        # Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø®Ø±ÙˆØ¬
        fallbacks=[CommandHandler("cancel", cancel)],
    )

    app.add_handler(conv_handler)

    # Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ØªØ¨Ø¯Ø£ Ø§Ù„Ø¨ÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
    app.add_handler(MessageHandler(filters.ALL, start))

    logger.info("ğŸš€ Ø¨ÙˆØª Ø¨ÙÙƒØ³Ù„Ø© Ø´ØºÙ‘Ø§Ù„!")
    app.run_polling()


# â–¶ï¸ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
if __name__ == "__main__":
    main()
